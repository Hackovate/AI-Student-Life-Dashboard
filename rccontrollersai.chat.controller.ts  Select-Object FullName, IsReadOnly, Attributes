warning: in the working copy of 'backend/src/controllers/ai.chat.controller.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'backend/src/controllers/auth.controller.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'backend/src/routes/academic.routes.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'client/src/components/pages/Academics.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'client/src/lib/useAuth.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'momentum-ai/routes/chat.py', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/backend/src/controllers/ai.chat.controller.ts b/backend/src/controllers/ai.chat.controller.ts[m
[1mindex fe1a55e9..67bd62c4 100644[m
[1m--- a/backend/src/controllers/ai.chat.controller.ts[m
[1m+++ b/backend/src/controllers/ai.chat.controller.ts[m
[36m@@ -25,6 +25,9 @@[m [mexport const chat = async (req: Request, res: Response) => {[m
         educationLevel: true,[m
         institution: true,[m
         major: true,[m
[32m+[m[32m        class: true,[m
[32m+[m[32m        year: true,[m
[32m+[m[32m        group: true,[m
         unstructuredContext: true[m
       }[m
     });[m
[36m@@ -48,8 +51,22 @@[m [mexport const chat = async (req: Request, res: Response) => {[m
     try {[m
       courses = await prisma.course.findMany({[m
         where: { userId },[m
[31m-        select: { courseName: true },[m
[31m-        take: 5[m
[32m+[m[32m        include: {[m
[32m+[m[32m          classSchedule: true,[m
[32m+[m[32m          assignments: {[m
[32m+[m[32m            orderBy: { dueDate: 'asc' },[m
[32m+[m[32m            take: 10[m
[32m+[m[32m          },[m
[32m+[m[32m          exams: {[m
[32m+[m[32m            orderBy: { date: 'asc' },[m
[32m+[m[32m            take: 10[m
[32m+[m[32m          },[m
[32m+[m[32m          attendanceRecords: {[m
[32m+[m[32m            orderBy: { date: 'desc' },[m
[32m+[m[32m            take: 20[m
[32m+[m[32m          }[m
[32m+[m[32m        },[m
[32m+[m[32m        take: 20[m
       });[m
 [m
       skills = await prisma.skill.findMany({[m
[36m@@ -154,11 +171,46 @@[m [mexport const chat = async (req: Request, res: Response) => {[m
 [m
     // Build structured context summary[m
     const structuredContextParts: string[] = [];[m
[31m-    if (user?.educationLevel) structuredContextParts.push(`Education: ${user.educationLevel}`);[m
[32m+[m[32m    if (user?.educationLevel) {[m
[32m+[m[32m      let educationInfo = `Education: ${user.educationLevel}`;[m
[32m+[m[32m      if (user.educationLevel === 'school' && user.class) {[m
[32m+[m[32m        educationInfo += `, Class: ${user.class}`;[m
[32m+[m[32m      }[m
[32m+[m[32m      if ((user.educationLevel === 'college' || user.educationLevel === 'university') && user.year) {[m
[32m+[m[32m        educationInfo += `, Year: ${user.year}`;[m
[32m+[m[32m      }[m
[32m+[m[32m      if ((user.educationLevel === 'school' || user.educationLevel === 'college') && user.group) {[m
[32m+[m[32m        educationInfo += `, Group: ${user.group}`;[m
[32m+[m[32m      }[m
[32m+[m[32m      structuredContextParts.push(educationInfo);[m
[32m+[m[32m    }[m
     if (user?.institution) structuredContextParts.push(`Institution: ${user.institution}`);[m
     if (user?.major) structuredContextParts.push(`Major: ${user.major}`);[m
     if (courses.length > 0) {[m
[31m-      structuredContextParts.push(`Courses: ${courses.map(c => c.courseName).join(', ')}`);[m
[32m+[m[32m      const coursesList = courses.map(c => {[m
[32m+[m[32m        const courseInfo = [`${c.courseName}${c.courseCode ? ` (${c.courseCode})` : ''}`];[m
[32m+[m[32m        if (c.attendance !== null) courseInfo.push(`Attendance: ${c.attendance.toFixed(1)}%`);[m
[32m+[m[32m        if (c.progress !== null) courseInfo.push(`Progress: ${c.progress}%`);[m
[32m+[m[32m        if (c.status) courseInfo.push(`Status: ${c.status}`);[m
[32m+[m[32m        if (c.classSchedule.length > 0) {[m
[32m+[m[32m          const schedules = c.classSchedule.map(s => `${s.day} ${s.time}${s.type ? ` (${s.type})` : ''}`).join(', ');[m
[32m+[m[32m          courseInfo.push(`Schedule: ${schedules}`);[m
[32m+[m[32m        }[m
[32m+[m[32m        if (c.assignments.length > 0) {[m
[32m+[m[32m          const pendingAssignments = c.assignments.filter(a => a.status === 'pending' || a.status === 'in_progress');[m
[32m+[m[32m          if (pendingAssignments.length > 0) {[m
[32m+[m[32m            courseInfo.push(`Pending Assignments: ${pendingAssignments.map(a => a.title).join(', ')}`);[m
[32m+[m[32m          }[m
[32m+[m[32m        }[m
[32m+[m[32m        if (c.exams.length > 0) {[m
[32m+[m[32m          const upcomingExams = c.exams.filter(e => new Date(e.date) >= new Date());[m
[32m+[m[32m          if (upcomingExams.length > 0) {[m
[32m+[m[32m            courseInfo.push(`Upcoming Exams: ${upcomingExams.map(e => e.title || 'Exam').join(', ')}`);[m
[32m+[m[32m          }[m
[32m+[m[32m        }[m
[32m+[m[32m        return courseInfo.join(' | ');[m
[32m+[m[32m      }).join('\n');[m
[32m+[m[32m      structuredContextParts.push(`Courses/Subjects:\n${coursesList}`);[m
     }[m
     if (skills.length > 0) {[m
       const skillsList = skills.map(s => `${s.name} (${s.category || 'General'}, ${s.level || 'beginner'})`).join(', ');[m
[36m@@ -279,15 +331,270 @@[m [mexport const chat = async (req: Request, res: Response) => {[m
             console.log('User data updated via AI:', action.data);[m
             actionResults.push({ type: action.type, success: true });[m
           } else if (action.type === 'add_course') {[m
[31m-            await prisma.course.create({[m
[32m+[m[32m            // Determine if this is a school/college subject or university course[m
[32m+[m[32m            const isSchoolOrCollege = user?.educationLevel === 'school' || user?.educationLevel === 'college';[m
[32m+[m[41m            [m
[32m+[m[32m            if (isSchoolOrCollege) {[m
[32m+[m[32m              // For school/college: subject name and group (stored in description)[m
[32m+[m[32m              await prisma.course.create({[m
[32m+[m[32m                data: {[m
[32m+[m[32m                  userId,[m
[32m+[m[32m                  courseName: action.data.name || action.data.courseName,[m
[32m+[m[32m                  courseCode: null,[m
[32m+[m[32m                  description: action.data.group || action.data.description || 'Subject',[m
[32m+[m[32m                  credits: null,[m
[32m+[m[32m                  semester: null,[m
[32m+[m[32m                  year: null,[m
[32m+[m[32m                  status: 'ongoing',[m
[32m+[m[32m                  progress: 0,[m
[32m+[m[32m                  attendance: 0,[m
[32m+[m[32m                }[m
[32m+[m[32m              });[m
[32m+[m[32m            } else {[m
[32m+[m[32m              // For university: full course details[m
[32m+[m[32m              await prisma.course.create({[m
[32m+[m[32m                data: {[m
[32m+[m[32m                  userId,[m
[32m+[m[32m                  courseName: action.data.name || action.data.courseName,[m
[32m+[m[32m                  courseCode: action.data.code || action.data.courseCode || null,[m
[32m+[m[32m                  description: action.data.description || null,[m
[32m+[m[32m                  credits: action.data.credits ? parseInt(action.data.credits.toString()) : (action.data.credits === 0 ? 0 : 3),[m
[32m+[m[32m                  semester: action.data.semester ? action.data.semester.toString() : null,[m
[32m+[m[32m                  year: action.data.year ? parseInt(action.data.year.toString()) : null,[m
[32m+[m[32m                  status: action.data.status || '